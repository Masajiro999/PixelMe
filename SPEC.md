# 📄 仕様書：Pixel Art Generator（非LLMベース）

## 1. 🧭 目的

本システムは、ユーザーがアップロードした実写画像（主に顔写真・上半身）を、**アニメ風のピクセルアート（64×64または128×128）**に自動変換する。
**生成処理はLLMを一切使用せず**、以下の画像処理・AI技術（軽量モデル）に基づいて実現する。

---

## 2. 🔧 システム構成

```
[入力画像]
　↓
[前処理]
　↓
[顔・人体検出]
　↓
[幾何変形処理（ちび化）]
　↓
[色処理（パステル化）]
　↓
[陰影生成（トゥーンシェーディング）]
　↓
[低解像度化 + ピクセルアート化]
　↓
[出力PNG画像]
```

---

## 3. 🧩 機能詳細

### 3.1 入力条件

| 項目  | 内容                    |
| --- | --------------------- |
| 形式  | JPEG, PNG             |
| 解像度 | 〜2048px 四方まで推奨        |
| 内容  | 単一人物の顔〜上半身が明確に写っていること |

---

### 3.2 前処理

| ステップ   | 技術                                       |
| ------ | ---------------------------------------- |
| 顔検出    | MediaPipe Face Detection or OpenCV DNN   |
| 背景除去   | grabCut or MediaPipe Selfie Segmentation |
| サイズ標準化 | 最長辺512pxに縮小（保持アスペクト比）                    |
| ガンマ補正  | γ=1.2〜1.4でやや明るく補正（任意）                    |

---

### 3.3 ちびキャラ化（デフォルメ）

| ステップ    | 技術・方法                           |
| ------- | ------------------------------- |
| 骨格推定    | MediaPipe Pose or BlazePose     |
| 顔ランドマーク | MediaPipe Face Mesh             |
| 幾何変形    | アフィン変換＋非線形モーフィングで頭部拡大・胴体圧縮      |
| 目強調     | 顔領域内の目を検出し、指定比率でスプライト合成 or 拡大補間 |

---

### 3.4 カラーパレット変換（パステル処理）

| ステップ   | 技術                               |
| ------ | -------------------------------- |
| 色空間変換  | RGB → CIELAB                     |
| パレット定義 | 固定パステル32色パレット（L>75, S低め）         |
| 色量子化   | k-means clustering or median-cut |
| 適用     | 各ピクセルを最近傍パレット色にマッピング             |

---

### 3.5 陰影処理（トゥーン・ピクセルシャドウ）

| ステップ      | 技術                                  |
| --------- | ----------------------------------- |
| ポスタリゼーション | 3〜5段階の明度レベルに分割（グレースケール処理）           |
| シェーディング   | 簡易法：法線近似 or 輝度閾値による2階調影付け           |
| 境界補正      | 輪郭強調用：Canny edge検出 or Laplacianフィルタ |

---

### 3.6 ピクセル化・解像度処理

| ステップ     | 技術                                      |
| -------- | --------------------------------------- |
| 縮小       | Nearest Neighbor法による縮小（64×64または128×128） |
| 輪郭抽出（任意） | 黒色または濃色での縁取り処理                          |
| 出力       | PNG形式、透明背景も可（背景レイヤーを切り離し）               |

---

## 4. 🖥️ 開発環境・依存技術

| 項目      | 推奨                                        |
| ------- | ----------------------------------------- |
| 言語      | Python 3.x / JavaScript（Web版）             |
| 画像処理    | OpenCV / PIL / NumPy                      |
| AIモジュール | MediaPipe / TensorFlow Lite (ブラウザなら tfjs) |
| 実行環境    | PC（CPU/GPU）、またはWebAssembly（WASM）          |
| ブラウザ対応  | Chrome, Firefox, Edge（WebGL必須）            |

---

## 5. ⚠️ 制限事項・リスク

* 顔検出や骨格認識が失敗する画像（横顔、マスク着用など）には非対応。
* 入力画像の品質（明るさ、解像度）によって、変換精度が著しく低下する場合がある。
* 髪のディテールや服装の装飾は大幅に簡略化される。
* 複数人物・ペット等には非対応（1人限定）。

---

## 6. 💡 拡張可能な項目（任意）

| 機能         | 備考                              |
| ---------- | ------------------------------- |
| アニメ風スタイル適用 | 独自のStyle Transferモジュール（軽量）で追加可能 |
| 表情変換       | 事前定義された表情スプライトとの合成              |
| 服・アクセの合成   | テンプレート着せ替え（画像マッチングベース）          |

---

## 7. ✅ 実装可否まとめ

| 機能        | LLM依存性         | 実装可能性       |
| --------- | -------------- | ----------- |
| 顔・骨格検出    | なし（MediaPipe等） | ◎           |
| ちびキャラ変形   | なし             | ○（ただし精度に限界） |
| 色変換（パステル） | なし             | ◎           |
| トゥーン陰影    | なし             | ○           |
| ピクセル縮小    | なし             | ◎           |
| 表情生成      | LLM非依存では限定的    | △           |
| 髪・服の詳細描写  | 高精度にはAIモデル必要   | ×〜△         |

---

## 📁 出力例

* `output/avatar_128x128.png`
* `output/avatar_64x64_transparent.png`

---

## 📌 備考

* 本仕様は完全に**LLM非依存**で設計されています。
* 「かわいい表現」「アニメらしさ」など**定性的・抽象的表現**を用いないため、見た目の完成度は制限されます。
* ただし、**リアル画像を自動的にデフォルメ・ピクセル化する処理パイプライン**としては、教育用途・同人開発・軽量環境において有用です。